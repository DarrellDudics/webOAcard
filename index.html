<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js webgl - interactive - voxel painter</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
    body {
        font-family: Monospace;
        background-color: #f0f0f0;
        margin: 0px;
        overflow: hidden;
    }

    </style>
</head>

<body>
    <div id="container" style="z-index: 1; position: absolute; left:0px; top:0px"></div>
    
    <script src="js/three.min.js"></script>
    <script src="js/stats.min.js"></script>
    <script src="js/Detector.js"></script>
    <script src="js/jquery-1.9.1.js"></script>
    <script src="js/jquery.mousewheel.min.js"></script>
    <script src="js/OrbitControls.js"></script>
    <!--script src="js/GeometryUtils.js"></script-->
    <!--script src="js/ImageUtils.js"></script-->

    <script src="js/Javascript_Clipper_6.1.3.2/clipper.js"></script>

    <script src="js/oa.core.js"></script>
    <script src="js/oa.model.js"></script>
    <script src="js/oa.face.js"></script>
    <script src="js/oa.contour.js"></script>

    <script>
    if (!Detector.webgl) Detector.addGetWebGLMessage();
    var debugMode = true;
    var camera, scene, renderer;
    var modelOption = {
        angle: 90,
        cardW: 64,
        cardH: 100
    };
    var oaModel = new OA.Model(modelOption);
    var sceneOffset = new THREE.Vector3(oaModel.getCardW() / 2, oaModel.getCardH() / 3, 0);
    var viewerR = oaModel.getCardH() * 2.5;
    var thetaX = 0,
        thetaY = 10;
    var mouse2D = new THREE.Vector3(0, 10000, 0.5);
    var orbitCtrls;

    function init(oa) {

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 20000);
        scene.add(camera);
       
        camera.position.set(0, 0, oaModel.getCardH() * 2.5);

        if (Detector.webgl)
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
        else
            renderer = new THREE.CanvasRenderer();

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0xf0f0f0);

        container = document.getElementById('container');
        container.appendChild(renderer.domElement);
        orbitCtrls = new THREE.OrbitControls(camera, renderer.domElement);
        orbitCtrls.noPan = true;
        orbitCtrls.panLeft(-sceneOffset.x);
        orbitCtrls.panUp(sceneOffset.y);
        orbitCtrls.maxPolarAngle = 120*Math.PI/180;
        orbitCtrls.rotateUp(20*Math.PI/180);
        orbitCtrls.zoomSpeed = 0.1;
        orbitCtrls.minDistance = oaModel.getCardH() * 2.5;

        oaModel.setCameraCtrl(orbitCtrls);
        //orbitCtrls.rotateLeft(-10*Math.PI/180);
        if (debugMode) {
            OA.Utils.debugaxis(scene, oa, 1000);
            stats = new Stats();
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '0px';
            container.appendChild(stats.domElement);
        }

        scene.add(oaModel);
        //bind Event
        window.addEventListener('resize', onWindowResize, false);
        // document.addEventListener('mousemove', onDocumentMouseMove, false);
        document.addEventListener('mousedown', onDocumentMouseDown, false);
        // document.addEventListener('keydown', onDocumentKeyDown, false);
        // document.addEventListener('mousedown', onMouseDown, false);
        // document.addEventListener('keyup', onDocumentKeyUp, false);

        // //window.addEventListener('DOMMouseScroll', onMousewheel, false);
         $(window).bind("mousewheel", onMousewheel);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function onDocumentMouseMove(event) {
        event.preventDefault();
        mouse2D.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse2D.y = -(event.clientY / window.innerHeight) * 2 + 1;
    }

       function onMousewheel(event, delta, deltaX, deltaY) {
            var d = ((deltaY < 0) ? 1 : -1);
            console.log(delta, deltaX, deltaY);

            // var newDist = formatFloat(editPlane.oaInfo.dist + gridStep * d, 4);
            // if (d > 0 && newDist < cardH) {
            //     editPlane.position.z = newDist;
            //     editPlane.oaInfo.dist = newDist;
            //     viewerR += gridStep;
            // } else if (d < 0 && newDist > 0) {
            //     editPlane.position.z = newDist;
            //     editPlane.oaInfo.dist = newDist;
            //     viewerR -= gridStep;
            // }
            // //event.stopPropagation();
            // event.preventDefault();

            // var d = ((deltaY < 0) ? -1 : 1);
            // //console.log(delta, deltaX, deltaY);
            // var newAngle = cardAngle + d * 5;
            // if (newAngle >= 0 && newAngle <= 180) {
            //     cardAngle = newAngle;
            // }
        }


    function onDocumentMouseDown(event) {
        event.preventDefault();
        if (event.which == 2){
            orbitCtrls.enabled =  orbitCtrls.enabled ? false: true;
         
        }
    }



    function animate() {
        requestAnimationFrame(animate);
        render();
        if (stats) {
            stats.update();
        }
        orbitCtrls.update();
    }


    function render() {
        oaModel.tick();
        renderer.render(scene, camera);
    }

    init(oaModel);
    animate();

        </script>

        
    </body>

    </html>
